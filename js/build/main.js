define("keys",[],function(){var e={parse:{appId:"nf7EL4ENYxYPum2r4no4NAig7fLCvV9k6g8tu7pK",jsKey:"WieRV1niYt4jU1D8aQKSp5II93k6Nfq2sDv5aDVb"},facebook:{appId:"681617298528861"}};return e}),define("models/state_model",["parse"],function(){var e=Parse.Object.extend("AppState",{defaults:{loginStatus:!1},logOut:function(){console.log(this.get("loginStatus")),Parse.User.logOut(),this.set({loginStatus:!1})}});return new e}),define("models/userinfo_model",["parse"],function(){var e=Parse.Object.extend("UserInfo",{defaults:{desiredActivity:"",hoursFree:2},setDefaults:function(){(!this.has("desiredActivity")||!this.has("hoursFree"))&&this.set("hoursFree",this.defaults.hoursFree)},getExpirationTime:function(){var e=new Date(this.get("statusUpdatedAt").getTime()+this.get("hoursFree")*36e5);return e}});return e}),define("models/clock_model",["parse"],function(){var e=Parse.Object.extend("Clock",{initialize:function(){var e=this;e.set("time",new Date),Parse.Cloud.run("getServerTime",{},{success:function(t){e.set("time",t)},error:function(e){console.log(e)}}),this.startClock(6e4)},startClock:function(e){var t=this;setInterval(function(){t.set("time",new Date(t.get("time").getTime()+e))},e)}});return e}),define("collections/friendstatuses_collection",["models/userinfo_model","models/clock_model","parse","facebook"],function(e,t){var n=Parse.Collection.extend({model:e,comparator:function(e){return-1*e.get("statusUpdatedAt").getTime()},initialize:function(){var n=this;this.clock=new t,FB.api("/me/friends?fields=id",function(t){if(t.data){var r=[];$.each(t.data,function(e,t){r.push(t.id)}),r.push(Parse.User.current().get("authData").facebook.id),n.query=new Parse.Query(e),n.query.exists("desiredActivity"),n.query.containedIn("fb_id",r),n.fetch({})}else console.log(t.error)})}});return n}),define("views/main/status_view",["parse","jquery","underscore"],function(e,t,n){var r=e.View.extend({template:n.template(t("#message_feed-status-template").html()),events:{},className:"user-status",initialize:function(){},getTimestampHTML:function(){var e="",t="",r="user-status-timestamp",i=this.model.getExpirationTime(),s=this.model.collection.clock.get("time"),o=i-s;if(o<=0)this.modelJSON.fb_chatLink=!1,r+=" user-status-timestamp-expired",e="expired",t="expired on "+i.toLocaleString();else{var u=parseInt(o/36e5%24,10),a=parseInt(o/6e4%60,10);e=u+":"+(a<10?"0":"")+a,t="free for ",u>0&&(t+=u+" hour"+(u===1?"":"s")+" and "),a>0||a===0&&u>0?t+=a+" minute"+(a===1?"":"s"):t+="less than a minute"}var f=n.template('<div class="<%= classes %>" title="<%= timestampTitle %>"><%= timestamp %></div>');return f({timestamp:e,timestampTitle:t,classes:r})},render:function(){return this.modelJSON=this.model.toJSON(),this.modelJSON.fb_chatLink=!0,this.modelJSON.timestampHTML=this.getTimestampHTML(),this.modelJSON.desiredActivity=n.escape(this.modelJSON.desiredActivity),e.User.current().get("authData").facebook.id===this.modelJSON.fb_id&&(this.modelJSON.fb_chatLink=!1,this.modelJSON.fb_name="You"),t(this.el).html(this.template(this.modelJSON)),this.el}});return r}),define("views/main/messagefeed_view",["views/main/status_view","parse","jquery"],function(e,t,n){var r=t.View.extend({events:{},el:n("#message_feed"),initialize:function(){this.render(),this.collection.on("reset",this.render,this),this.collection.clock.on("change:time",this.render,this)},render:function(){n("#message_feed").html(""),this.collection.each(this.addOne)},addOne:function(t){var r=new e({model:t});n("#message_feed").append(r.render())}});return r}),define("views/main/statusupdate_view",["views/main/messagefeed_view","parse","jquery","underscore"],function(e,t,n,r){var i=t.View.extend({events:{"click .plusMinusButtons":"alterFreeTime","click #bored_button":"saveStatus","keypress #desired-activity-textarea":"updateOnEnter","blur #desired-activity-textarea":"cacheStatus"},template:r.template(n("#app-main-template").html()),subtemplate:r.template(n("#hours_selector-template").html()),id:"findFreeFriends",initialize:function(){this.model.setDefaults(),this.render(),this.message_feed=new e({collection:this.collection}),this.model.on("change:hoursFree",this.renderHoursSelector,this)},updateOnEnter:function(e){if(e.keyCode===13&&e.shiftKey===!1)return this.$("#bored_button").is(":disabled")?!1:(this.saveStatus(),!1)},cacheStatus:function(){this.model.set("desiredActivity",n("#desired-activity-textarea").val())},saveStatus:function(){this.cacheStatus();var e=this;e.$("#bored_button").attr("disabled","disabled"),this.model.save({success:function(){e.$("#bored_button").removeAttr("disabled"),e.collection.fetch({})},error:function(t){e.$("#bored_button").removeAttr("disabled")}})},alterFreeTime:function(e){var t=.5,n=9,r=.5,i=Number(this.model.get("hoursFree")),s=e.currentTarget.id;s==="plus_button"&&this.model.set("hoursFree",Math.min(n,i+r)),s==="minus_button"&&this.model.set("hoursFree",Math.max(t,i-r))},render:function(){n(this.el).html(this.template()),n("#main .content_container").html(this.el),require(["plugins/jquery.elastic.min"],function(){n("#desired-activity-textarea").elastic()}),n("#hours_selector").html(this.subtemplate(this.model.toJSON()))},renderHoursSelector:function(){n("#hours_selector").html(this.subtemplate(this.model.toJSON()))}});return i}),define("views/main/main_view",["collections/friendstatuses_collection","views/main/statusupdate_view","parse"],function(e,t){var n=Parse.View.extend({el:"#main",initialize:function(){var n=this;this.friendStatuses=new e,this.UserInfo=Parse.User.current().get("UserInfo"),this.UserInfo.fetch({}).then(function(){n.status_update=new t({model:n.UserInfo,collection:n.friendStatuses})})},render:function(){}});return n}),define("views/main/header_view",["models/state_model","parse","underscore","jquery"],function(e){var t=Parse.View.extend({events:{"click #logoutButton":"logOut"},el:"#header",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#app-header-template").html()))},logOut:function(){e.logOut()}});return t}),define("views/login/loginheader_view",["models/state_model","parse","jquery","underscore"],function(e){var t=Parse.View.extend({events:{"click #loginButton":"logIn"},el:"#header",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#login-header-template").html()))},logIn:function(){var t=this;return Parse.FacebookUtils.logIn("user_friends",{success:function(t){Parse.User.current().save().then(function(){return Parse.Cloud.run("initUser",{})}).then(function(){return Parse.User.current().fetch({})}).then(function(){e.set("loginStatus",!0);return},function(e){console.log(e)})},error:function(e,t){console.log("User cancelled the Facebook login or did not fully authorize.")}}),!1}});return t}),define("views/login/loginmain_view",["parse","jquery","underscore"],function(){var e=Parse.View.extend({el:"#main",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#login-main-template").html()))}});return e}),define("views/settings/settings_view",["parse","jquery","underscore"],function(){var e=Parse.View.extend({el:"#main",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#settings-template").html()))}});return e}),define("views/dev/dev_view",["parse","jquery","underscore"],function(){var e=Parse.View.extend({el:"#main",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#dev-template").html()))}});return e}),define("views/404/error404_view",["parse","jquery","underscore"],function(){var e=Parse.View.extend({el:"#main",initialize:function(){this.render()},render:function(){this.$(".content_container").html(_.template($("#error-404-template").html()))}});return e}),define("views/app_view",["views/main/header_view","parse","jquery"],function(e){var t=Parse.View.extend({el:$("#global_container"),events:{},initialize:function(){this.options.subHeader=this.options.subHeader||e,this.render()},render:function(){new this.options.subHeader,new this.options.subView}});return t}),define("router",["models/state_model","views/main/main_view","views/main/header_view","views/login/loginheader_view","views/login/loginmain_view","views/settings/settings_view","views/dev/dev_view","views/404/error404_view","views/app_view"],function(e,t,n,r,i,s,o,u,a){var f=Parse.Router.extend({routes:{"":"home",dev:"dev",settings:"settings","*404":"error404"},initialize:function(){this.model=e,this.model.on("change:loginStatus",this.nav,this)},nav:function(){console.log("router.nav"),e.get("loginStatus")===!1?this.login():this.home()},home:function(){new a({subView:t})},login:function(){new a({subView:i,subHeader:r})},dev:function(){new a({subView:o})},settings:function(){new a({subView:s})},error404:function(){new a({subView:u})},route:function(t,n,r){var i=this.login,s=function(){return e.get("loginStatus")===!1?i():r()};return Parse.Router.prototype.route(t,n,s)}});return f}),define("app",["jquery","keys","parse","facebook","models/state_model","router"],function(e,t,n,r,i,s){(function(){n.initialize(t.parse.appId,t.parse.jsKey),n.FacebookUtils.init({appId:t.facebook.appId,xfbml:!1,version:"v2.1"}),r.getLoginStatus(function(e){e.status==="connected"&&n.User.current()&&n.User.current().get("authData").facebook.id===e.authResponse.userID?i.set("loginStatus",!0):i.logOut(),new s,n.history.start({pushState:!0})})})()}),requirejs.config({baseUrl:"js",paths:{jquery:["//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min","libraries/jquery-1.11.1"],underscore:["//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min","libraries/underscore"],parse:["http://www.parsecdn.com/js/parse-1.3.1.min","libraries/parse-1.3.1"],facebook:["//connect.facebook.net/en_US/all","libraries/facebook"]},shim:{parse:{exports:"Parse"},underscore:{exports:"_"},facebook:{exports:"FB"}}}),requirejs(["app"]),define("main",function(){});